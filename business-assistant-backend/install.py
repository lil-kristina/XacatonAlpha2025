import subprocess
import sys
import os

def run_command(command):
    """–í—ã–ø–æ–ª–Ω—è–µ—Ç –∫–æ–º–∞–Ω–¥—É –∏ –≤—ã–≤–æ–¥–∏—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç"""
    try:
        result = subprocess.run(command, shell=True, check=True, 
                              capture_output=True, text=True)
        print(f"‚úÖ {command}")
        return True
    except subprocess.CalledProcessError as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –≤ –∫–æ–º–∞–Ω–¥–µ: {command}")
        print(f"–û—à–∏–±–∫–∞: {e.stderr}")
        return False

def install_dependencies():
    """–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏"""
    print("üöÄ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –¥–ª—è Business Assistant...")
    
    # –°–ø–∏—Å–æ–∫ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
    dependencies = [
        "fastapi==0.104.1",
        "uvicorn==0.24.0", 
        "pyodbc==4.0.39",
        "python-dotenv==1.0.0",
        "aiohttp==3.9.1",
        "python-telegram-bot==20.7",
        "pydantic==2.5.0",
        "python-multipart==0.0.6",
        "requests==2.31.0"
    ]
    
    # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–∞–∂–¥—É—é –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å
    for package in dependencies:
        command = f'"{sys.executable}" -m pip install {package}'
        if not run_command(command):
            print(f"‚ö†Ô∏è –ü—Ä–æ–ø—É—Å–∫–∞–µ–º {package}, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º —É—Å—Ç–∞–Ω–æ–≤–∫—É...")
    
    print("üéâ –í—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã!")

def check_installation():
    """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç —É—Å–ø–µ—à–Ω–æ—Å—Ç—å —É—Å—Ç–∞–Ω–æ–≤–∫–∏"""
    print("\nüîç –ü—Ä–æ–≤–µ—Ä—è–µ–º —É—Å—Ç–∞–Ω–æ–≤–∫—É...")
    
    packages_to_check = [
        "fastapi",
        "uvicorn", 
        "pyodbc",
        "aiohttp",
        "python_telegram_bot"
    ]
    
    for package in packages_to_check:
        try:
            if package == "python_telegram_bot":
                __import__("telegram")
            else:
                __import__(package)
            print(f"‚úÖ {package} - OK")
        except ImportError as e:
            print(f"‚ùå {package} - –ù–ï –£–°–¢–ê–ù–û–í–õ–ï–ù: {e}")

def main():
    """–û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è"""
    print("=" * 50)
    print("ü§ñ Business Assistant - –£—Å—Ç–∞–Ω–æ–≤—â–∏–∫ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π")
    print("=" * 50)
    
    # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
    install_dependencies()
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —É—Å—Ç–∞–Ω–æ–≤–∫—É
    check_installation()
    
    print("\nüéØ –ß—Ç–æ –¥–∞–ª—å—à–µ:")
    print("1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±—ç–∫–µ–Ω–¥: python main.py")
    print("2. –û—Ç–∫—Ä–æ–π—Ç–µ frontend/index.html –≤ –±—Ä–∞—É–∑–µ—Ä–µ")
    print("3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç—É –ø–æ –∞–¥—Ä–µ—Å—É: http://localhost:8000")

if __name__ == "__main__":
    main()
